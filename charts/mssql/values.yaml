# yaml-language-server: $schema=values.schema.json
# -- Logical ID of the database instance used to create an idempotent config-db ID
# that is consistent across restarts and db failovers
id: mssql

# -- Connection name for a connection:// reference (created externally)
# Use either connectionName OR url, not both
# connectionName: ""

# -- Direct connection string to the MSSQL server
# Example: "sqlserver://sa:YourStrong@Passw0rd@localhost:1433"
# url: ""

# -- Playbook configuration
playbooks:
  # -- Enable all playbooks
  enabled: true
  # -- Enable "Run SQL" playbook for executing arbitrary SQL
  runSql: true
  # -- Enable "Run Agent Job Now" playbook for executing T-SQL steps from agent jobs
  runAgentJob: true
  # -- Enable "Grant DB Access" playbook for granting temporary database access
  grantAccess: true
  # -- Enable "Kill Long Running Transactions" playbook
  killLongRunningTransactions: true
  # -- Enable "Restore Tables from Backup" playbook (requires backups.enabled)
  restoreTables: false

# -- Health check canary configuration
canary:
  # -- Cron schedule for health checks
  schedule: "@every 5m"
  # -- Enable health check canary
  enabled: true

# -- Scraper configuration for discovering MSSQL resources
scrape:
  # -- Cron schedule for full scrape
  schedule: "@every 4h"
  # -- Cron schedule for incremental scrape (changes only)
  incrementalSchedule: "@every 15m"
  # -- Scrape database information
  databases: true
  # -- Scrape SQL Agent jobs and their history
  jobs: true

# -- AWS RDS specific configuration
rds:
  # -- Enable RDS task scraping (for AWS RDS SQL Server instances)
  tasks: false

# -- Playbook approvers configuration
approvers:
  # -- List of people who can approve playbook executions
  people:
  # - admin
  # -- List of teams who can approve playbook executions
  # teams:
  #   - dba-team

# -- Backup scraper configuration for discovering .bak files in S3
backups:
  # -- Enable backup scraper
  enabled: false
  # -- Cron schedule for backup scraping
  schedule: "@every 4h"
  # -- Regex with named capture group 'database' to extract DB name from .bak filename
  # Default: everything before the first underscore
  databaseRegex: '^(?P<database>.*)_\d*T\d*\.bak$'
  # -- S3 URIs to scan for .bak files (s3://bucket/prefix format)
  s3: []
  # - s3://bucket-name/backups/prefix1/
  # - s3://bucket-name/backups/prefix2/
