{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "additionalProperties": false,
  "properties": {
    "approvers": {
      "additionalProperties": false,
      "description": "Playbook approvers configuration",
      "properties": {
        "people": {
          "description": "List of people who can approve playbook executions\npeople:\n- admin",
          "items": {
            "required": []
          },
          "title": "people",
          "type": "array"
        },
        "runSql": {
          "type": "boolean",
          "description": "Enable Run SQL playbook for executing arbitrary SQL",
          "default": true
        },
        "runAgentJob": {
          "type": "boolean",
          "description": "Enable Run Agent Job Now playbook for executing T-SQL steps from agent jobs",
          "default": true
        },
        "grantAccess": {
          "type": "boolean",
          "description": "Enable Grant DB Access playbook for granting temporary database access",
          "default": true
        },
        "killLongRunningTransactions": {
          "type": "boolean",
          "description": "Enable Kill Long Running Transactions playbook",
          "default": true
        },
        "restoreTables": {
          "type": "boolean",
          "description": "Enable Restore Tables from Backup playbook (requires backups.enabled)",
          "default": false
        }
      },
      "required": [
        "people",
        "teams"
      ],
      "title": "approvers",
      "type": "object"
    },
    "canary": {
      "additionalProperties": false,
      "description": "Health check canary configuration",
      "properties": {
        "enabled": {
          "default": true,
          "description": "Enable health check canary",
          "title": "enabled",
          "type": "boolean"
        },
        "schedule": {
          "default": "@every 5m",
          "description": "Cron schedule for health checks",
          "title": "schedule",
          "type": "string"
        }
      },
      "required": [
        "schedule",
        "enabled"
      ],
      "title": "canary",
      "type": "object"
    },
    "connectionName": {
      "default": "",
      "description": "Connection name for a connection:// reference (created externally)\nUse either connectionName OR url, not both",
      "title": "connectionName",
      "type": "string"
    },
    "global": {
      "description": "Global values are values that can be accessed from any chart or subchart by exactly the same name.",
      "required": [],
      "title": "global",
      "type": "object"
    },
    "id": {
      "default": "mssql",
      "description": "yaml-language-server: $schema=values.schema.json\nLogical ID of the database instance used to create an idempotent config-db ID\nthat is consistent across restarts and db failovers",
      "title": "id",
      "type": "string"
    },
    "playbooks": {
      "additionalProperties": false,
      "description": "Playbook configuration",
      "properties": {
        "createUser": {
          "additionalProperties": false,
          "description": "Create Login User playbook configuration (This needs KMS connection --secret-keeper-connection",
          "properties": {
            "emailConnection": {
              "default": "",
              "description": "Email connection reference for sending credentials (required when enabled)\nExample: \"connection://default/smtp\" or \"connection://notifications/email\"",
              "title": "emailConnection",
              "type": "string"
            },
            "enabled": {
              "default": false,
              "description": "Enable \"Create Login User\" playbook for creating new SQL logins",
              "title": "enabled",
              "type": "boolean"
            }
          },
          "required": [
            "enabled",
            "emailConnection"
          ],
          "title": "createUser",
          "type": "object"
        },
        "enabled": {
          "default": true,
          "description": "Enable all playbooks",
          "title": "enabled",
          "type": "boolean"
        },
        "grantAccess": {
          "default": true,
          "description": "Enable \"Grant DB Access\" playbook for granting temporary database access",
          "title": "grantAccess",
          "type": "boolean"
        },
        "killLongRunningTransactions": {
          "default": true,
          "description": "Enable \"Kill Long Running Transactions\" playbook",
          "title": "killLongRunningTransactions",
          "type": "boolean"
        },
        "runAgentJob": {
          "default": true,
          "description": "Enable \"Run Agent Job Now\" playbook for executing T-SQL steps from agent jobs",
          "title": "runAgentJob",
          "type": "boolean"
        },
        "runSql": {
          "default": true,
          "description": "Enable \"Run SQL\" playbook for executing arbitrary SQL",
          "title": "runSql",
          "type": "boolean"
        }
      },
      "required": [
        "enabled",
        "runSql",
        "runAgentJob",
        "grantAccess",
        "killLongRunningTransactions",
        "createUser"
      ],
      "title": "playbooks",
      "type": "object"
    },
    "rds": {
      "additionalProperties": false,
      "description": "AWS RDS specific configuration",
      "properties": {
        "tasks": {
          "default": false,
          "description": "Enable RDS task scraping (for AWS RDS SQL Server instances)",
          "title": "tasks",
          "type": "boolean"
        }
      },
      "required": [
        "tasks"
      ],
      "title": "rds",
      "type": "object"
    },
    "scrape": {
      "additionalProperties": false,
      "description": "Scraper configuration for discovering MSSQL resources",
      "properties": {
        "databases": {
          "default": true,
          "description": "Scrape database information",
          "title": "databases",
          "type": "boolean"
        },
        "incrementalSchedule": {
          "default": "@every 15m",
          "description": "Cron schedule for incremental scrape (changes only)",
          "title": "incrementalSchedule",
          "type": "string"
        },
        "jobs": {
          "default": true,
          "description": "Scrape SQL Agent jobs and their history",
          "title": "jobs",
          "type": "boolean"
        },
        "schedule": {
          "default": "@every 4h",
          "description": "Cron schedule for full scrape",
          "title": "schedule",
          "type": "string"
        }
      }
    },
    "backups": {
      "type": "object",
      "description": "Backup scraper configuration for discovering .bak files in S3",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable backup scraper",
          "default": false
        },
        "schedule": {
          "type": "string",
          "description": "Cron schedule for backup scraping",
          "default": "@every 1h"
        },
        "databaseRegex": {
          "type": "string",
          "description": "Regex with named capture group 'database' to extract DB name from .bak filename",
          "default": "^(?P<database>.*)_\\d*T\\d*\\.bak$"
        },
        "s3": {
          "type": "array",
          "description": "S3 URIs to scan for .bak files (s3://bucket/prefix format)",
          "items": {
            "type": "string"
          },
          "default": []
        }
      }
    }
  },
  "required": [
    "id",
    "connectionName",
    "url",
    "playbooks",
    "canary",
    "scrape",
    "rds",
    "approvers"
  ],
  "type": "object"
}